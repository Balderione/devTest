@istest
public class WSIT03_ACWS_Test {
    @isTest static void FinancialCenterUpsertError() {
        
        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"", "IT_Contract_Progressive":null, "IT_Client_Code":"", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2019-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"", "IT_Technical_Data_Progressive":null, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"", "IT_AC_Activity":"", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":null, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"", "IT_Group_Type":"01", "IT_Client_Code":"", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsert() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2019-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsertError2() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2019-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsertFuture() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1GGGGGGGG", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2099-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2099-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2099-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2099-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2029-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2029-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2029-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2029-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2029-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2099-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2099-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsertFuture2() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2019-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2099-01-01", "IT_Validity_End_Date":"209-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2099-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
     @isTest static void FinancialCenterUpsertFuture3() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2019-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2059-01-01", "IT_Validity_End_Date":"2099-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2059-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }

    @isTest static void FinancialCenterUpsertFuture4() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2059-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[{ "IT_Opportunity_Code":"StringString", "IT_Contract_Number":"StringString", "IT_Contract_Progressive":32, "IT_Client_Code":"445566", "IT_Attendance_Type":"02", "IT_Contract_Renewal_Type":"01", "IT_Contract_Type":"01", "IT_Contract_Status":"01", "StartDate":"2059-01-01", "EndDate":"2019-01-01", "IT_Sign_Sending_Date":"2019-01-01", "IT_Contract_Sign_Date":"2019-01-01", "IT_Expiration_Contract_Date":"2019-01-01", "IT_Contract_Closing_Type":"056", "IT_Penal_Presence":"StringString", "IT_Delivery_Date_Bond":"0", "IT_Delivery_Term":32, "IT_Term_Type":"L", "IT_Delivery_Fixed_Day":32, "IT_Fixed_Day_Type":"L", "IT_Order_Reception_Term":32, "IT_Order_Reception_Term_Type":"L", "IT_No_Sign_Activation_Authorization":"StringString", "IT_Reception_Type":"StringString", "IT_No_Massive_Print":"StringString", "IT_Date_presence":"StringString", "IT_No_Date_Presence":"StringString", "IT_SDD_Payment":"StringString", "IT_Multidiscount":"StringString", "IT_Extradiscount":"StringString", "IT_No_Exclusivity":"StringString", "IT_Annual_Potential":32, "IT_Renewal_Reason":"01", "IT_Accepts_Privacy":"StringString", "IT_Framework_Head_Code":"TEST", "IT_Framework_Warrant":"StringString", "IT_Only_Client_Copy":"StringString", "IT_Supply_Conditions":"StringString", "IT_Campaign_Start_Date":"2019-01-01", "IT_Campaing_End_Date":"2019-01-01", "IT_Card_Cost":10.23, "IT_Card_Cost_Billing_Type":"StringString", "IT_Card_Cost_Billing_Frequency":"StringString", "IT_Card_Cost_Billing_Rules":"8", "IT_UTA_Monthly_Limit":10.23, "IT_UTA_Offer_Type":"014", "IT_UTA_Vehicles_Number":32, "IT_AC_User":"StringString"}], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2099-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }], "IT_Additional_Expenses": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_Code":"222", "IT_Amount":10.23, "IT_Calculation_Type":"0", "IT_AC_User":"SMASAN", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null } ], "IT_Note": [ { "IT_Progressive":1, "IT_Client_Code":"445566", "IT_AC_Activity":"222522", "IT_SF_Activity":"", "IT_AC_Delivery":null, "IT_SF_Delivery":null, "IT_Note_Type":"012", "IT_Title":"TEST WS03 2", "IT_Text_Notes":"Questo è proprio un bel test 2", "IT_Validity_Start_Date":"2020-01-29", "IT_Validity_End_Date":null, "IT_AC_User":"SMASAN" } ] }] } ');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsertFuture5() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        Contract contractTest = APIT14_DataFactory.create_Contract(accountTest.Id);
        contractTest.IT_Financial_center__c = FinancialTest.Id;
        contractTest.IT_Client_Code__c = '445566';
        insert contractTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[{ "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code":"004", "IT_SDD_Payment_Code":"145", "IT_Bank_Account_Code":"5621", "IT_ABI":"07601", "IT_CAB":"01600", "IT_CC":"000028426203", "IT_CIN":"Z", "IT_Country":"IT", "IT_Check_Iban":"37", "IT_SDD_Contract_Code":"TESTTES", "IT_SDD_Subscription_Date":"2019-01-01", "IT_SDD_Fiscal_Code":"StringString", "IT_Authorized":"2", "IT_Special_Billing_Type":"X", "IT_Commission_Type":"0", "IT_Commission_Percentage":10.23, "IT_Discount_Type":"2", "IT_Discount_Percentage":10.23, "IT_Fine_Interest_Type":"B1", "IT_Not_Standard_VAT":"1", "IT_Transport_Cost":"29", "IT_No_Cost_Reason":"01", "IT_Promo_Code":"TESTTES", "IT_Invoice_Detail":"0", "IT_Invoice_Detraction":"0", "IT_Send_SUT_Printout":"StringString", "IT_Debt_Notes":"0", "IT_Debt_Notes_Effective_Date":"2019-01-01", "IT_Debt_Notes_Percentage":10.23, "IT_Debt_Notes_Locale_Type":"01", "IT_Expendia_Startup_Cost":10.23, "IT_Number_of_Expendia_cards":32, "IT_Expendia_Monthly_Fee":10.23, "IT_Card_Amount":10.23, "IT_Flexben_Startup_Cost":10.23, "IT_Flexben_Startup_Date":"2019-01-01", "IT_Flexben_Fee_Cost":10.23, "IT_Flexben_Fee_Date":"2019-01-01", "IT_Flexben_Fee_Frequency":"02", "IT_Accepts_New_Billing_System_PA":"StringString", "IT_Office_Code":"StringString", "IT_CUP_Code":"StringString", "IT_Order_Code":"StringString", "IT_EORI_Code":"StringString", "IT_Accepts_New_Billing_System":"StringString", "IT_SDI":"TESTTES", "IT_PEC_Mail":"StringString@test.it", "IT_Dont_Send_Debt_Note":"StringString", "IT_Particularities_Progressive_Number":32, "IT_Contractual_Particularities":"StringString", "IT_Economic_AC_User":"StringString", "IT_Economic_Validity_Start_Date":"2019-01-01", "IT_Economic_Validity_End_Date":"2019-01-01", "IT_Contract":[], "IT_Billable_Service":[{ "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":12, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Technical_Data_Progressive":13, "IT_Product":"T0", "IT_Feedback_Type":"01", "IT_Logo_Type":"01", "IT_Feedback_Request":"StringString", "IT_Ticket_Type":"1", "IT_Font_Type":"06", "IT_Order_Receipts_Type":"023", "IT_Order_Frequence_Type":"01", "IT_Single_Series_Emission":"StringString", "IT_Ticket_Return_Request":"StringString", "IT_Itinerant_Client":"StringString", "IT_Ticket_Display":"StringString", "IT_No_Ads":"StringString", "IT_No_Insert":"StringString", "IT_Display_Locale":"StringString", "IT_Display_Address":"StringString", "IT_Display_Active_Name":"StringString", "IT_Address_Row_Display":"StringString", "IT_Amount_Display":"StringString", "IT_Amount":10.23, "IT_Logo_Code":"StringString", "IT_Business_Association_Logo_Type":"StringString", "IT_Business_Association_Font_Type":"StringString", "IT_Business_Association_Logo_Code":"StringString", "IT_Printout_Employee_Copies_Number":32, "IT_Emitted_Ticket_Copies_Number":32, "IT_Card_Type":"StringString", "IT_Web_Enabling_Level":"01", "IT_File_Sending_Authorization":"StringString", "IT_Front_and_Back_Printout":"StringString", "IT_Stock_Orders":"0", "IT_Graphic_Layer_Front":"StringString", "IT_Graphic_Layer_Back":"StringString", "IT_Graphic_Background_Front":"StringString", "IT_Graphic_Background_Back":"StringString", "IT_Envelope":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Distribution_Point":[{ "IT_Client_Code":"445566", "IT_AC_Activity":"411163", "IT_SF_Activity":"", "IT_Suspension":"StringString", "IT_Cancellation":"StringString", "IT_Cancellation_Type":"056", "IT_Employees_Number":32, "IT_Technical_Data_Progressive":12, "IT_Contact_Code":"299", "IT_Cost_Center":"StringString", "IT_Free_Description_to_Display":"StringString", "IT_Address_to_Display":"StringString", "IT_Locality_to_Display":"StringString", "IT_Naming_to_Display":"StringString", "IT_Raw_Number_for_Display":32, "IT_Data_to_Display":"StringString", "IT_Data_Type_to_Display":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Delivery_Site":[{ "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2059-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Group":[{ "IT_Group_Code":"888995", "IT_Group_Type":"01", "IT_Client_Code":"445566", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }], "IT_Address":[{ "IT_Client_Code":"445566", "IT_Ticket_Naming":"Address_F_AT", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"32", "IT_Hamlet_Code":"32", "IT_Sestiere_Code":"32", "IT_Street_Code":"32", "IT_Road_Arch_Code":"32", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"F", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }, { "IT_Type":"AT", "IT_Delivery_AC":"", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"" }] }, { "IT_Client_Code":"445566", "IT_Ticket_Naming":"AddressDelivery", "IT_Province":"StringString", "IT_Toponym":"StringString", "IT_Street":"StringString", "IT_Short_Address":"StringString", "IT_Street_Number":"StringString", "IT_Postal_Code":"StringString", "IT_City":"StringString", "IT_Hamlet":"StringString", "IT_Additional_Locality":"StringString", "IT_City_Code":"33", "IT_Hamlet_Code":"33", "IT_Sestiere_Code":"33", "IT_Street_Code":"33", "IT_Road_Arch_Code":"33", "IT_MetRef_Loc_X":"10.23", "IT_MetRef_Loc_Y":"10.23", "IT_GeoRef_Loc_X":"10.23", "IT_GeoRef_Loc_Y":"10.23", "IT_Extra_Urban_Specifications":"StringString", "IT_Zone":"128", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01", "IT_AddressType":[{ "IT_Type":"C", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"", "IT_Activity_SF":"" }] }] } ] }');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
    @isTest static void FinancialCenterUpsertWithoutActivitiesNotManagedAC() {

        IT_ControlUpdateTrigger__c settings = IT_ControlUpdateTrigger__c.getOrgDefaults();
        settings.IT_ControlTreiggerUpdate__c = true;
        insert settings;

        IT_Custom_Control__c settingC = new IT_Custom_Control__c();
        settingC.Name = 'Control Consegna';
        settingC.IT_Custom_Text__c = 'Consegna Fittizia';
        insert settingC;

        Account accountTest = APIT14_DataFactory.create_BusinessAccount();
        accountTest.ER_VAT_Number__c = '02554698475';
        insert accountTest;
        Contact contactTest = APIT14_DataFactory.create_Contact(accountTest.Id);
        contactTest.IT_Code__c = 'StringString';
        insert contactTest;
        IT_Contact_Detail__c contactDetailTest = APIT14_DataFactory.create_Contact_Detail(contactTest.Id);
        contactDetailTest.IT_Code__c = 'StringString';
        insert contactDetailTest;
        ER_Financial_Center__c FinancialTest = APIT14_DataFactory.create_FinancialCenter(accountTest.Id, contactTest.Id);
        FinancialTest.ER_Card_Operational_System_ID__c = 'Tes2w';
        FinancialTest.ER_Type__c = 'Client'; 
        FinancialTest.IT_Financial_Center__c = '445566';
        insert FinancialTest;
        Contract contractTest = APIT14_DataFactory.create_Contract(accountTest.Id);
        contractTest.IT_Financial_center__c = FinancialTest.Id;
        contractTest.IT_Client_Code__c = '445566';
        insert contractTest;
        ER_Delivery_Site__c deliverysiteTest = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTest.IT_Delivery_AC__c = '555666';
        insert deliverysiteTest;
        ER_Delivery_Site__c deliverysiteTestFittizia = APIT14_DataFactory.create_DeliverySite(FinancialTest.Id, accountTest.Id);
        deliverysiteTestFittizia.IT_Delivery_AC__c = '555666';
        deliverysiteTestFittizia.Name = 'Consegna Fittizia';
        insert deliverysiteTestFittizia;
        ER_Distribution_Point__c distributionPointTest = APIT14_DataFactory.create_DistributionPoint(FinancialTest.Id, deliverysiteTest.Id);
        distributionPointTest.IT_AC_Activity__c = 'lkjhg';
        insert distributionPointTest;
        ER_Bank_Account__c bankAccountTest = APIT14_DataFactory.create_BankAccount(FinancialTest.Id);
        bankAccountTest.IT_Client_Code__c = '445566';
        insert bankAccountTest;
        IT_Group_Code__c groupCodeTest = APIT14_DataFactory.create_GroupCode(FinancialTest.Id);
        groupCodeTest.IT_Client_Code__c = '445566';
        insert groupCodeTest;
        Product2 testProduct = APIT14_DataFactory.create_Product();
        insert testProduct;

        RestRequest request = new RestRequest();
        RestResponse res = new RestResponse();
        request.requestUri = '/services/apexrest/ac_financial_center/';
        request.httpMethod = 'PUT';
        request.addHeader('Content-Type', 'application/json');
        request.requestBody = Blob.valueOf('{ "ER_Financial_Center":[ { "IT_Client_Code":"445566", "IT_Service":"1G", "IT_Client_Status":"01", "IT_VAT_Number":"02554698475", "IT_Employee_Number":32, "IT_Single_Client_Multiactivity":true, "IT_Client_Situation":"01", "IT_Opening_Outcome":"001", "IT_Concurrency":"051", "IT_Beneficiary_Type":"01", "IT_Previous_Code":"RRRR", "IT_Fused_Client":"RRR", "IT_New_Code":"00T1", "IT_Associated_Client":"RRR", "IT_Company_Name":"StringStringStringStringStringStringStringStringStringStringStringStringStringString", "IT_Short_name":"StringString", "IT_Extended_Company_Name":"StringString", "IT_CIG":"RR", "IT_Derived_CIG":"RR", "IT_Circuit_Code":"000", "IT_Client_Type":"1", "IT_Contact_Code":"299", "IT_Admin_Data_AC_User":"StringString", "IT_Admin_Data_Validity_Start_Date":"2019-01-01", "IT_Admin_Data_Validity_End_Date":"2019-01-01", "IT_Payment_Code": null, "IT_SDD_Payment_Code": null, "IT_Bank_Account_Code": null, "IT_ABI": null, "IT_CAB": null, "IT_CC": null, "IT_CIN": null, "IT_Country": null, "IT_Check_Iban": null, "IT_SDD_Contract_Code": null, "IT_SDD_Subscription_Date": null, "IT_SDD_Fiscal_Code": null, "IT_Authorized": null, "IT_Special_Billing_Type": null, "IT_Commission_Type": null, "IT_Commission_Percentage": null, "IT_Discount_Type": null, "IT_Discount_Percentage": null, "IT_Fine_Interest_Type": null, "IT_Not_Standard_VAT": null, "IT_Transport_Cost": null, "IT_No_Cost_Reason": null, "IT_Promo_Code": null, "IT_Invoice_Detail": null, "IT_Invoice_Detraction": null, "IT_Send_SUT_Printout": null, "IT_Debt_Notes": null, "IT_Debt_Notes_Effective_Date": null, "IT_Debt_Notes_Percentage": null, "IT_Debt_Notes_Locale_Type": null, "IT_Expendia_Startup_Cost": null, "IT_Number_of_Expendia_cards": null, "IT_Expendia_Monthly_Fee": null, "IT_Card_Amount": null, "IT_Flexben_Startup_Cost": null, "IT_Flexben_Startup_Date": null, "IT_Flexben_Fee_Cost": null, "IT_Flexben_Fee_Date": null, "IT_Flexben_Fee_Frequency": null, "IT_Accepts_New_Billing_System_PA": null, "IT_Office_Code": null, "IT_CUP_Code": null, "IT_Order_Code": null, "IT_EORI_Code": null, "IT_Accepts_New_Billing_System": null, "IT_SDI": null, "IT_PEC_Mail": null, "IT_Dont_Send_Debt_Note": null, "IT_Particularities_Progressive_Number": null, "IT_Contractual_Particularities": null, "IT_Economic_AC_User": null, "IT_Economic_Validity_Start_Date": null, "IT_Economic_Validity_End_Date": null, "IT_Iban": null, "IT_Billing_Frequency_UTA": null, "IT_Bond_UTA": null, "IT_Discount_Percentage_2": null, "IT_Discount_Percentage_3": null, "IT_Discount_Validity_Date_2": null, "IT_Discount_Validity_Date_3": null, "IT_Extradiscount_Percentage": null, "IT_Type_Extradiscount": null, "IT_Contract":[  ], "IT_Billable_Service":[  ], "IT_Distribution_Point":[  ], "IT_Delivery_Site":[ { "IT_Client_Code":"445566", "IT_Delivery_AC":"445569", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":"2019-01-01" }, { "IT_Client_Code":"445566", "IT_Delivery_AC":"445888", "IT_Delivery_SF":"", "IT_Activity_AC":"411163", "IT_Activity_SF":"StringString", "IT_Delivery_Type":"A", "IT_Delivery_Point":true, "IT_Branch":"StringString", "IT_Provider":"0001", "IT_Vehicle":"0032", "IT_Vehicle_Forcing":false, "IT_Special_Service":"StringString", "IT_Matched_Delivery":32, "IT_Notes_type":"043", "IT_Notes":"StringString", "IT_Text":"StringString", "IT_AC_User":"StringString", "IT_Validity_Start_Date":"2019-01-01", "IT_Validity_End_Date":null } ], "IT_Group":[  ], "IT_Address":[  ], "IT_Additional_Expenses":[  ], "IT_Note":[  ] } ] }');
        RestContext.request = request;
        RestContext.response= res;
        WSIT03_ACWS.AnagraficaClientiUpsert();  
    }
}